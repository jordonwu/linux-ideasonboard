// SPDX-License-Identifier: (GPL-2.0+ OR MIT)
//
// Copyright 2020 Borea

/dts-v1/;

#include "imx8mm.dtsi"

/ {
	model = "Borea Rayplicker v2 board";
	compatible = "borea,rayplicker-v2", "fsl,imx8mm";

	chosen {
		stdout-path = &uart1;
	};

	memory@40000000 {
		reg = <0x00000000 0x40000000 0 0>; /* will be filled by U-Boot */
		device_type = "memory";
	};

	beeper {
		compatible = "pwm-beeper";
		pwms = <&pwm3 0 2700>;
		beeper-hz = <2700>;
	};

	usdhc3_pwrseq: usdhc3-pwrseq {
		compatible = "mmc-pwrseq-simple";
		reset-gpios = <&gpio1 19 GPIO_ACTIVE_LOW>;
	};

	regulators {
		compatible = "simple-bus";
		#address-cells = <1>;
		#size-cells = <0>;

		regulator-tft-vcc {
			compatible = "regulator-fixed";
			regulator-name = "tft-vcc";
			gpio = <&gpio1 9 GPIO_ACTIVE_HIGH>;
			enable-active-high;
			regulator-min-microvolt = <13000000>;
			regulator-max-microvolt = <13000000>;
			regulator-always-on; /* TODO: Make this runtime-controllable */
		};

		regulator-tft-vio {
			compatible = "regulator-fixed";
			regulator-name = "tft-vio";
			gpio = <&gpio1 10 GPIO_ACTIVE_LOW>;
			enable-active-low;
			regulator-min-microvolt = <3300000>;
			regulator-max-microvolt = <3300000>;
			regulator-always-on; /* TODO: Make this runtime-controllable */
		};
	};
};

&A53_0 {
	cpu-supply = <&buck2_reg>;
};

&ecspi1 {
	pinctrl-names = "default";
	pinctrl-0 = <&pinctrl_ecspi1>;
	status = "okay";

	/* CS is controlled by SS0. */
	num-cs = <1>;

	/* Densitron TFT Display */
	display@0 {
		pinctrl-names = "default";
		pinctrl-0 = <&pinctrl_tft>;
		compatible = "solomon,ssd1351";
		reg = <0>;

		spi-max-frequency = <20000000>;

		dc-gpios = <&gpio1 7 GPIO_ACTIVE_HIGH>;
		reset-gpios = <&gpio1 8 GPIO_ACTIVE_LOW>;

		backlight = <2>; /* On-board backlight */
		bgr;
		buswidth = <8>;
		gamma = "0 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 4 4 4 4 4 4 4 4 4 4 4 4 4 4";
	};
};

&micfil {
	pinctrl-names = "default";
	pinctrl-0 = <&pinctrl_pdm>;
	assigned-clocks = <&clk IMX8MM_CLK_PDM>;
	assigned-clock-parents = <&clk IMX8MM_AUDIO_PLL1_OUT>;
	assigned-clock-rates = <196608000>;
	status = "okay";
};

&pwm3 {
	pinctrl-names = "default";
	pinctrl-0 = <&pinctrl_pwm3>;
	status = "okay";
};

&snvs_pwrkey {
	status = "okay";
};

/* console */
&uart1 {
	pinctrl-names = "default";
	pinctrl-0 = <&pinctrl_uart1>;
	status = "okay";
};

/* Bluetooth */
&uart2 {
	pinctrl-names = "default";
	pinctrl-0 = <&pinctrl_uart2 &pinctrl_bluetooth>;
	uart-has-rtscts;
	status = "okay";
};

&usbotg1 {
	dr_mode = "peripheral";
	disable-over-current;
	status = "okay";
};

/* eMMC */
&usdhc1 {
	pinctrl-names = "default", "state_100mhz", "state_200mhz";
	pinctrl-0 = <&pinctrl_usdhc1>;
	pinctrl-1 = <&pinctrl_usdhc1_100mhz>;
	pinctrl-2 = <&pinctrl_usdhc1_200mhz>;
	bus-width = <8>;
	non-removable;
	vmmc-supply = <&buck4_reg>;
	vqmmc-supply = <&buck5_reg>;
	mmc-ddr-1_8v;
	mmc-hs200-1_8v;
	mmc-hs400-1_8v;
	mmc-hs400-enhanced-strobe;
	status = "okay";
};

/* WiFi */
&usdhc3 {
	pinctrl-names = "default";
	pinctrl-0 = <&pinctrl_usdhc3>;
	bus-width = <4>;
	no-1-8-v;
	non-removable;
	mmc-pwrseq = <&usdhc3_pwrseq>;
	keep-power-in-suspend;
	cap-power-off-card;
	status = "okay";

	#address-cells = <1>;
	#size-cells = <0>;

	brcmf: wifi@1 {
		compatible = "brcm,bcm4329-fmac";
		reg = <1>;
		interrupt-parent = <&gpio1>;
		interrupts = <21 IRQ_TYPE_LEVEL_LOW>;
		interrupt-names = "host-wake";
	};
};

&i2c1 {
	clock-frequency = <100000>;
	pinctrl-names = "default";
	pinctrl-0 = <&pinctrl_i2c1>;
	status = "okay";

	pmic: pmic@25 {
		compatible = "nxp,pca9450a";
		reg = <0x25>;
		pinctrl-names = "default";
		pinctrl-0 = <&pinctrl_pmic>;
		interrupt-parent = <&gpio1>;
		interrupts = <3 IRQ_TYPE_LEVEL_LOW>;

		regulators {
			pca9450,pmic-buck2-uses-i2c-dvs;

			/* VDD_SOC_0V8 */
			buck1_reg: BUCK1 {
				regulator-name = "BUCK1";
				regulator-min-microvolt = <800000>;
				regulator-max-microvolt = <800000>;
				regulator-boot-on;
				regulator-always-on;
				regulator-ramp-delay = <3125>;
			};

			/* VDD_ARM_0V9 */
			buck2_reg: BUCK2 {
				regulator-name = "BUCK2";
				regulator-min-microvolt = <850000>;
				regulator-max-microvolt = <975000>;
				regulator-boot-on;
				regulator-always-on;
				regulator-ramp-delay = <3125>;
				nxp,dvs-run-voltage = <975000>;
				nxp,dvs-standby-voltage = <850000>;
			};

			/* VDD_DRAM_PU_0V9 */
			buck3_reg: BUCK3 {
				regulator-name = "BUCK3";
				regulator-min-microvolt = <850000>;
				regulator-max-microvolt = <950000>;
				regulator-boot-on;
				regulator-always-on;
			};

			/* VDD_3V3 */
			buck4_reg: BUCK4 {
				regulator-name = "BUCK4";
				regulator-min-microvolt = <3300000>;
				regulator-max-microvolt = <3300000>;
				regulator-boot-on;
				regulator-always-on;
			};

			/* VDD_1V8 */
			buck5_reg: BUCK5 {
				regulator-name = "BUCK5";
				regulator-min-microvolt = <1800000>;
				regulator-max-microvolt = <1800000>;
				regulator-boot-on;
				regulator-always-on;
			};

			/* NVCC_DRAM_1V1 */
			buck6_reg: BUCK6 {
				regulator-name = "BUCK6";
				regulator-min-microvolt = <1100000>;
				regulator-max-microvolt = <1100000>;
				regulator-boot-on;
				regulator-always-on;
			};

			/* NVCC_SNVS_1V8 */
			ldo1_reg: LDO1 {
				regulator-name = "LDO1";
				regulator-min-microvolt = <1800000>;
				regulator-max-microvolt = <1800000>;
				regulator-boot-on;
				regulator-always-on;
			};

			/* VDD_SNVS_0V8 */
			ldo2_reg: LDO2 {
				regulator-name = "LDO2";
				regulator-min-microvolt = <800000>;
				regulator-max-microvolt = <800000>;
				regulator-boot-on;
				regulator-always-on;
			};

			/* VDDA_1V8 */
			ldo3_reg: LDO3 {
				regulator-name = "LDO3";
				regulator-min-microvolt = <1800000>;
				regulator-max-microvolt = <1800000>;
				regulator-boot-on;
				regulator-always-on;
			};

			/* VDD_PHY_0V9 */
			ldo4_reg: LDO4 {
				regulator-name = "LDO4";
				regulator-min-microvolt = <900000>;
				regulator-max-microvolt = <900000>;
				regulator-boot-on;
				regulator-always-on;
			};

			ldo5_reg: LDO5 {
				regulator-name = "LDO5";
				regulator-min-microvolt = <1800000>;
				regulator-max-microvolt = <3300000>;
			};
		};
	};

        /* Touchscreen */
	touch@38 {
		pinctrl-names = "default";
		pinctrl-0 = <&pinctrl_touchscreen>;

		compatible = "edt,edt-ft5206";
		reg = <0x38>;
		interrupts-extended = <&gpio1 6 IRQ_TYPE_EDGE_FALLING>;
		reset-gpios = <&gpio1 5 GPIO_ACTIVE_LOW>;
	};

	lsm6dsm@6a {
		compatible = "st,lsm6dsm";
		reg = <0x6a>;
		pinctrl-names = "default";
		pinctrl-0 = <&pinctrl_imu>;
		interrupt-parent = <&gpio1>;
		interrupts = <23 IRQ_TYPE_EDGE_RISING>,
			     <22 IRQ_TYPE_EDGE_RISING>;
	};

	max17048@36 {
		compatible = "maxim,max17048";
		reg = <0x36>;
		pinctrl-names = "default";
		pinctrl-0 = <&pinctrl_gauge>;
		interrupt-parent = <&gpio1>;
		interrupts = <0 IRQ_TYPE_LEVEL_LOW>;
	};

	mcp3021@4d {
		compatible = "microchip,mcp3021";
		reg = <0x4d>;
		reference-voltage-microvolt = <3300000>; /* 3.3 V */
	};
};

&i2c3 {
	clock-frequency = <100000>;
	pinctrl-names = "default";
	pinctrl-0 = <&pinctrl_i2c3>;
	status = "okay";
};

&wdog1 {
	pinctrl-names = "default";
	pinctrl-0 = <&pinctrl_wdog>;
	fsl,ext-reset-output;
	status = "okay";
};

&iomuxc {
	pinctrl-names = "default";
	pinctrl-0 = <&pinctrl_gpios>,
		    <&pinctrl_leds_driver>, <&pinctrl_leds_power>,
		    <&pinctrl_camera>;

	pinctrl_bluetooth: bluetoothgrp {
		fsl,pins = <
			/* BT_EN */
			MX8MM_IOMUXC_ENET_RXC_GPIO1_IO25	0x92
		>;
	};

	pinctrl_camera: cameragrp {
		fsl,pins = <
			MX8MM_IOMUXC_GPIO1_IO15_CCMSRCGPCMIX_CLKO2	0x90
			/* CAM_RESET */
			MX8MM_IOMUXC_SAI1_TXD0_GPIO4_IO12	0x92
			/* CAM_PWR_ON# */
			MX8MM_IOMUXC_SAI1_TXD2_GPIO4_IO14	0x92
		>;
	};

	pinctrl_ecspi1: ecspi1grp {
		fsl,pins = <
			MX8MM_IOMUXC_ECSPI1_MOSI_ECSPI1_MOSI	0x90
			MX8MM_IOMUXC_ECSPI1_SCLK_ECSPI1_SCLK	0x90
			MX8MM_IOMUXC_ECSPI1_SS0_ECSPI1_SS0	0x90
		>;
	};

	pinctrl_gpios: gpiosgrp {
		fsl,pins = <
			MX8MM_IOMUXC_SD2_CD_B_GPIO2_IO12		0x90
			MX8MM_IOMUXC_SD2_CLK_GPIO2_IO13			0x90
			MX8MM_IOMUXC_SD2_CMD_GPIO2_IO14			0x90
			MX8MM_IOMUXC_SD2_DATA0_GPIO2_IO15		0x90
			MX8MM_IOMUXC_SD2_DATA2_GPIO2_IO17		0x90
			MX8MM_IOMUXC_SD2_DATA3_GPIO2_IO18		0x90
			MX8MM_IOMUXC_SD2_RESET_B_GPIO2_IO19		0x90
		>;
	};

	pinctrl_i2c1: i2c1grp {
		fsl,pins = <
			MX8MM_IOMUXC_I2C1_SCL_I2C1_SCL			0x40000082
			MX8MM_IOMUXC_I2C1_SDA_I2C1_SDA			0x40000082
		>;
	};

	pinctrl_i2c3: i2c3grp {
		fsl,pins = <
			MX8MM_IOMUXC_I2C3_SCL_I2C3_SCL			0x40000082
			MX8MM_IOMUXC_I2C3_SDA_I2C3_SDA			0x40000082
		>;
	};

	pinctrl_imu: imugrp {
		fsl,pins = <
			MX8MM_IOMUXC_ENET_TXC_GPIO1_IO23	0x92
			MX8MM_IOMUXC_ENET_TX_CTL_GPIO1_IO22	0x92
		>;
	};

	pinctrl_leds_driver: ledsdrivergrp {
		fsl,pins = <
			/* LED_SOUT */
			MX8MM_IOMUXC_ECSPI2_MISO_GPIO5_IO12	0x92
			/* LED_SIN */
			MX8MM_IOMUXC_ECSPI2_MOSI_GPIO5_IO11	0x92
			/* LED_SCLK */
			MX8MM_IOMUXC_ECSPI2_SCLK_GPIO5_IO10	0x92
			/* LED_LAT */
			MX8MM_IOMUXC_ECSPI2_SS0_GPIO5_IO13	0x92
		>;
	};

	pinctrl_leds_power: ledspowergrp {
		fsl,pins = <
			MX8MM_IOMUXC_SAI1_TXD6_GPIO4_IO18	0x90
		>;
	};

	pinctrl_pdm: pdmgrp {
		fsl,pins = <
			MX8MM_IOMUXC_SAI5_RXC_PDM_CLK		0x00
			MX8MM_IOMUXC_SAI5_RXD0_PDM_DATA0	0x90
		>;
	};

	pinctrl_pmic: pmicgrp {
		fsl,pins = <
			MX8MM_IOMUXC_GPIO1_IO03_GPIO1_IO3		0x90
		>;
	};

	pinctrl_pwm3: pwm3grp {
		fsl,pins = <
			MX8MM_IOMUXC_GPIO1_IO14_PWM3_OUT	0x92
		>;
	};

	pinctrl_gauge: gaugegrp {
		fsl,pins = <
			MX8MM_IOMUXC_GPIO1_IO01_GPIO1_IO1		0x90
		>;
	};

	pinctrl_tft: tftgrp {
		fsl,pins = <
			/* TFT_D-C */
			MX8MM_IOMUXC_GPIO1_IO07_GPIO1_IO7	0x92
			/* TFT_RESET */
			MX8MM_IOMUXC_GPIO1_IO08_GPIO1_IO8	0x92
			/* TFT_VCC_PWR */
			MX8MM_IOMUXC_GPIO1_IO09_GPIO1_IO9	0x92
			/* TFT_VIO_PWR# */
			MX8MM_IOMUXC_GPIO1_IO10_GPIO1_IO10	0x92
		>;
	};

	pinctrl_touchscreen: touchscreengrp {
		fsl,pins = <
			/* TOUCH_RST */
			MX8MM_IOMUXC_GPIO1_IO05_GPIO1_IO5	0x92
			/* TOUCH_INT */
			MX8MM_IOMUXC_GPIO1_IO06_GPIO1_IO6	0x90
		>;
	};

	pinctrl_uart1: uart1grp {
		fsl,pins = <
			MX8MM_IOMUXC_UART1_RXD_UART1_DCE_RX	0x0E
			MX8MM_IOMUXC_UART1_TXD_UART1_DCE_TX	0x0E
		>;
	};

	pinctrl_uart2: uart2grp {
		fsl,pins = <
			MX8MM_IOMUXC_SAI3_RXC_UART2_DCE_CTS_B	0xD2
			MX8MM_IOMUXC_SAI3_RXD_UART2_DCE_RTS_B	0x92
			MX8MM_IOMUXC_SAI3_TXC_UART2_DCE_TX	0xD2
			MX8MM_IOMUXC_SAI3_TXFS_UART2_DCE_RX	0x92
		>;
	};

	pinctrl_usdhc1: usdhc1grp {
		fsl,pins = <
			MX8MM_IOMUXC_SD1_CLK_USDHC1_CLK			0x190
			MX8MM_IOMUXC_SD1_CMD_USDHC1_CMD			0x1d0
			MX8MM_IOMUXC_SD1_DATA0_USDHC1_DATA0		0x1d0
			MX8MM_IOMUXC_SD1_DATA1_USDHC1_DATA1		0x1d0
			MX8MM_IOMUXC_SD1_DATA2_USDHC1_DATA2		0x1d0
			MX8MM_IOMUXC_SD1_DATA3_USDHC1_DATA3		0x1d0
			MX8MM_IOMUXC_SD1_DATA4_USDHC1_DATA4		0x1d0
			MX8MM_IOMUXC_SD1_DATA5_USDHC1_DATA5		0x1d0
			MX8MM_IOMUXC_SD1_DATA6_USDHC1_DATA6		0x1d0
			MX8MM_IOMUXC_SD1_DATA7_USDHC1_DATA7		0x1d0
			MX8MM_IOMUXC_SD1_RESET_B_USDHC1_RESET_B 	0x1d0
			MX8MM_IOMUXC_SD1_STROBE_USDHC1_STROBE		0x190
		>;
	};

	pinctrl_usdhc1_100mhz: usdhc1grp100mhz {
		fsl,pins = <
			MX8MM_IOMUXC_SD1_CLK_USDHC1_CLK			0x194
			MX8MM_IOMUXC_SD1_CMD_USDHC1_CMD			0x1d4
			MX8MM_IOMUXC_SD1_DATA0_USDHC1_DATA0		0x1d4
			MX8MM_IOMUXC_SD1_DATA1_USDHC1_DATA1		0x1d4
			MX8MM_IOMUXC_SD1_DATA2_USDHC1_DATA2		0x1d4
			MX8MM_IOMUXC_SD1_DATA3_USDHC1_DATA3		0x1d4
			MX8MM_IOMUXC_SD1_DATA4_USDHC1_DATA4		0x1d4
			MX8MM_IOMUXC_SD1_DATA5_USDHC1_DATA5		0x1d4
			MX8MM_IOMUXC_SD1_DATA6_USDHC1_DATA6		0x1d4
			MX8MM_IOMUXC_SD1_DATA7_USDHC1_DATA7		0x1d4
			MX8MM_IOMUXC_SD1_RESET_B_USDHC1_RESET_B 	0x1d4
			MX8MM_IOMUXC_SD1_STROBE_USDHC1_STROBE		0x194
		>;
	};

	pinctrl_usdhc1_200mhz: usdhc1grp200mhz {
		fsl,pins = <
			MX8MM_IOMUXC_SD1_CLK_USDHC1_CLK			0x196
			MX8MM_IOMUXC_SD1_CMD_USDHC1_CMD			0x1d6
			MX8MM_IOMUXC_SD1_DATA0_USDHC1_DATA0		0x1d6
			MX8MM_IOMUXC_SD1_DATA1_USDHC1_DATA1		0x1d6
			MX8MM_IOMUXC_SD1_DATA2_USDHC1_DATA2		0x1d6
			MX8MM_IOMUXC_SD1_DATA3_USDHC1_DATA3		0x1d6
			MX8MM_IOMUXC_SD1_DATA4_USDHC1_DATA4		0x1d6
			MX8MM_IOMUXC_SD1_DATA5_USDHC1_DATA5		0x1d6
			MX8MM_IOMUXC_SD1_DATA6_USDHC1_DATA6		0x1d6
			MX8MM_IOMUXC_SD1_DATA7_USDHC1_DATA7		0x1d6
			MX8MM_IOMUXC_SD1_RESET_B_USDHC1_RESET_B 	0x1d6
			MX8MM_IOMUXC_SD1_STROBE_USDHC1_STROBE		0x196
		>;
	};

	pinctrl_usdhc3: usdhc3grp {
		fsl,pins = <
			MX8MM_IOMUXC_NAND_WE_B_USDHC3_CLK		0x92
			MX8MM_IOMUXC_NAND_WP_B_USDHC3_CMD		0x92
			MX8MM_IOMUXC_NAND_DATA04_USDHC3_DATA0		0x92
			MX8MM_IOMUXC_NAND_DATA05_USDHC3_DATA1		0x92
			MX8MM_IOMUXC_NAND_DATA06_USDHC3_DATA2		0x92
			MX8MM_IOMUXC_NAND_DATA07_USDHC3_DATA3		0x92
			/* WL_GPIO0 */
			MX8MM_IOMUXC_ENET_TD0_GPIO1_IO21		0x80
			/* WLAN_EN */
			MX8MM_IOMUXC_ENET_TD2_GPIO1_IO19		0x92
		>;
	};

	pinctrl_wdog: wdoggrp {
		fsl,pins = <
			MX8MM_IOMUXC_GPIO1_IO02_WDOG1_WDOG_B		0x92
		>;
	};
};
